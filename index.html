<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de QR Code</title>
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #dcf2e2; 
            color: #333;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 1200px; 
            background-color: transparent; 
            box-shadow: none; 
            border-radius: 8px;
            padding: 24px;
        }

        h1 {
            text-align: center;
            color: #111;
            margin-bottom: 24px;
        }

        h2 {
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
            margin-top: 0;
        }

        .geradores {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 20px;
        }

        @media (min-width: 768px) {
            .geradores {
                grid-template-columns: 1fr 1fr; 
            }
        }
        @media (min-width: 1024px) {
            .geradores {
                grid-template-columns: 1fr 1fr 1fr; 
            }
        }

        .box {
            background-color: rgba(255, 255, 255, 0.5); 
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="tel"], 
        input[type="email"], 
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        input#input-geo-url {
            background-color: #f1f5f9; 
            color: #64748b; 
            font-size: 0.9em;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #34c759; 
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        
        .box > button:last-of-type {
            margin-top: auto;
        }

        button:hover {
            background-color: #28a745; 
        }

        .btn-geo-auto {
            background-color: #6c757d;
            font-size: 14px;
            padding: 8px;
            margin-top: -5px; 
            margin-bottom: 12px;
        }
        .btn-geo-auto:hover {
            background-color: #5a6268;
        }

        .color-inputs {
            display: flex;
            justify-content: space-around;
            gap: 15px;
            padding: 10px 0;
            margin-top: auto; 
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .color-inputs > div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-inputs label {
            font-size: 14px;
            font-weight: 500;
        }
        .color-inputs input[type="color"] {
            width: 40px;
            height: 40px;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 6px; }
        input[type="color"]::-moz-color-swatch { border: none; border-radius: 6px; }


        .resultado {
            margin-top: 24px;
            text-align: center;
        }

        #qrcode {
            width: 256px;
            height: 256px;
            margin: 16px auto;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background-color: #fafafa;
            color: transparent; 
        }

        #qrcode img,
        #qrcode canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .botoes-resultado {
            display: flex;
            gap: 10px;
            justify-content: center;
            max-width: 278px;
            margin: 0 auto;
            margin-top: 16px;
        }
        .botoes-resultado button { width: auto; flex-grow: 1; }
        #btn-download { background-color: #28a745; }
        #btn-download:hover { background-color: #218838; }
        #btn-print { background-color: #6c757d; }
        #btn-print:hover { background-color: #5a6268; }
        #btn-limpar { background-color: #dc3545; }
        #btn-limpar:hover { background-color: #c82333; }

        .hidden {
            display: none;
        }

        @media print {
            body { background-color: #fff; padding: 0; }
            .container, footer { display: none; }
            .container > *:not(.resultado) { display: none; }
            .resultado { display: block; }
            .resultado h2, .botoes-resultado, .color-inputs { display: none; }
            #qrcode { border: none; box-shadow: none; margin: 0; padding: 0; }
        }

        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #333; 
        }
        footer p { margin: 5px 0; }

    </style>
</head>
<body>

    <div class="container">
        <h1>Gerador de QR Code</h1>

        <div class="geradores">
            <div class="box">
                <h2>Site / URL</h2>
                <input type="text" id="input-url" placeholder="https://seusite.com.br">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-url">Gerar QR Code</button>
            </div>
            
            <div class="box">
                <h2>Conex√£o Wi-Fi</h2>
                <input type="text" id="input-wifi-ssid" placeholder="Nome da rede (SSID)">
                <input type="password" id="input-wifi-pass" placeholder="Senha da rede">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-wifi">Gerar QR Code</button>
            </div>
            
            <div class="box">
                <h2>PIX (Gerador BR Code)</h2>
                <input type="text" id="input-pix-key" placeholder="Sua Chave PIX (CPF, e-mail, etc)">
                <input type="text" id="input-pix-name" placeholder="Seu Nome (at√© 25 chars)">
                <input type="text" id="input-pix-city" placeholder="Sua Cidade (at√© 15 chars)">
                <input type="text" id="input-pix-amount" placeholder="Valor (Ex: 10,50) (opcional)">
                <input type="text" id="input-pix-txid" placeholder="ID da Transa√ß√£o (opcional)">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-pix">Gerar QR Code PIX</button>
            </div>

            <div class="box">
                <h2>Cart√£o de Visita (vCard)</h2>
                <input type="text" id="input-vcard-nome" placeholder="Nome Completo">
                <input type="text" id="input-vcard-cargo" placeholder="Cargo (Ex: Desenvolvedor)">
                <input type="text" id="input-vcard-empresa" placeholder="Empresa">
                <input type="tel" id="input-vcard-tel" placeholder="Telefone (ex: +55 75 9...)">
                <input type="email" id="input-vcard-email" placeholder="E-mail">
                <input type="text" id="input-vcard-site" placeholder="Site (ex: https://...)">
                <input type="text" id="input-vcard-lat" placeholder="Latitude (opcional)">
                <input type="text" id="input-vcard-long" placeholder="Longitude (opcional)">
                <button type="button" id="btn-vcard-geo-auto" class="btn-geo-auto">üìç Usar minha localiza√ß√£o</button>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-vcard">Gerar vCard</button>
            </div>
            
            <div class="box">
                <h2>WhatsApp</h2>
                <input type="tel" id="input-whatsapp-tel" placeholder="N¬∫ (ex: 5575998312170)">
                <textarea id="input-whatsapp-msg" placeholder="Mensagem padr√£o (opcional)"></textarea>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-whatsapp">Gerar Link Zap</button>
            </div>
            
            <div class="box">
                <h2>Localiza√ß√£o (Google Maps)</h2>
                <p class="text-sm text-slate-600 mb-2">Clique no bot√£o para pegar sua localiza√ß√£o atual e gerar um link do Google Maps.</p>
                <input type="text" id="input-geo-url" placeholder="Link do Google Maps aparecer√° aqui..." readonly class="w-full p-2 border border-slate-300 rounded-md">
                <button type="button" id="btn-mapas-geo-auto" class="btn-geo-auto">üìç Obter Localiza√ß√£o (Google Maps)</button>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-geo">Gerar Mapa</button>
            </div>

        </div> 
        
        <div class="resultado">
            <h2>Seu QR Code:</h2>
            <div id="qrcode"></div>
            
            <div class="botoes-resultado">
                <button id="btn-download" class="hidden">Download (PNG)</button>
                <button id="btn-print" class="hidden">Imprimir</button>
                <button id="btn-limpar" class="hidden">Limpar</button>
            </div>
        </div>
    </div> 
    
    <footer>
        <p>Todos os direitos reservados ¬© 2025 J√¢nio Carlos P</p>
        <p>WhatsApp: 55 75 99831-2170</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        // --- Seletores B√°sicos ---
        const qrContainer = document.getElementById('qrcode');
        const resultadoSection = document.querySelector('.resultado'); 
        let qrcode = null;

        // --- Seletores dos Geradores (Bloco 1) ---
        const btnUrl = document.getElementById('btn-url');
        const inputUrl = document.getElementById('input-url');
        const btnWifi = document.getElementById('btn-wifi');
        const inputWifiSsid = document.getElementById('input-wifi-ssid');
        const inputWifiPass = document.getElementById('input-wifi-pass');
        
        // --- Seletores dos Geradores (Bloco 2) ---
        const btnPix = document.getElementById('btn-pix');
        const inputPixKey = document.getElementById('input-pix-key');
        const inputPixName = document.getElementById('input-pix-name');
        const inputPixCity = document.getElementById('input-pix-city');
        const inputPixAmount = document.getElementById('input-pix-amount');
        const inputPixTxid = document.getElementById('input-pix-txid');
        
        // --- Seletores do vCard ---
        const btnVCard = document.getElementById('btn-vcard');
        const inputVCardNome = document.getElementById('input-vcard-nome');
        const inputVCardCargo = document.getElementById('input-vcard-cargo');
        const inputVCardEmpresa = document.getElementById('input-vcard-empresa');
        const inputVCardTel = document.getElementById('input-vcard-tel');
        const inputVCardEmail = document.getElementById('input-vcard-email');
        const inputVCardSite = document.getElementById('input-vcard-site');
        const inputVCardLat = document.getElementById('input-vcard-lat');
        const inputVCardLong = document.getElementById('input-vcard-long');
        const btnVCardGeoAuto = document.getElementById('btn-vcard-geo-auto'); 
        
        // --- Seletores (WhatsApp) ---
        const btnWhatsapp = document.getElementById('btn-whatsapp');
        const inputWhatsappTel = document.getElementById('input-whatsapp-tel');
        const inputWhatsappMsg = document.getElementById('input-whatsapp-msg');

        // --- Seletores (Geo Mapas) ---
        const btnGeo = document.getElementById('btn-geo');
        const inputGeoUrl = document.getElementById('input-geo-url'); 
        const btnMapasGeoAuto = document.getElementById('btn-mapas-geo-auto'); 

        // --- Seletores (Resultado) ---
        const btnLimpar = document.getElementById('btn-limpar');
        const btnDownload = document.getElementById('btn-download');
        const btnPrint = document.getElementById('btn-print');


        /**
         * Fun√ß√£o principal de Gera√ß√£o (com Scroll)
         */
        function gerarQRCode(texto, event) {
            limparQRCode(false); 
            
            const box = event.target.closest('.box');
            const corPrincipal = box.querySelector('.color-dark-input').value;
            const corFundo = box.querySelector('.color-light-input').value;

            qrcode = new QRCode(qrContainer, {
                text: texto,
                width: 256,
                height: 256,
                colorDark: corPrincipal, 
                colorLight: corFundo,   
                correctLevel: QRCode.CorrectLevel.H 
            });
            
            btnLimpar.classList.remove('hidden');
            btnDownload.classList.remove('hidden');
            btnPrint.classList.remove('hidden');

            resultadoSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /**
         * Fun√ß√£o de Limpeza
         */
        function limparQRCode(resetColors = true) {
            if (qrcode) {
                qrcode.clear();
            }
            qrContainer.innerHTML = ''; 
            
            btnLimpar.classList.add('hidden');
            btnDownload.classList.add('hidden');
            btnPrint.classList.add('hidden');

            if (resetColors) {
                const allDark = document.querySelectorAll('.color-dark-input');
                const allLight = document.querySelectorAll('.color-light-input');
                allDark.forEach(input => input.value = "#000000");
                allLight.forEach(input => input.value = "#ffffff");
            }
        }
        
        btnLimpar.addEventListener('click', () => limparQRCode(true)); 

        /**
         * Bot√µes de A√ß√£o (Download/Print)
         */
        btnPrint.addEventListener('click', () => {
            window.print();
        });

        btnDownload.addEventListener('click', () => {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                alert('Erro: Canvas do QR Code n√£o encontrado.');
                return;
            }
            const imgURL = canvas.toDataURL('image/png');

            if (isIOS) {
                const newTab = window.open();
                newTab.document.write(`<img src="${imgURL}" alt="QR Code" style="width:100%;">`);
            } else {
                const link = document.createElement('a');
                link.href = imgURL;
                link.download = 'qrcode.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });
        
        // --- FUN√á√ïES DE GEOLOCALIZA√á√ÉO ---
        function checkSecureContext() {
            if (window.location.protocol !== 'https:') {
                alert('Este recurso s√≥ funciona em sites seguros (https).\n\nFunciona no link do GitHub Pages, mas n√£o no arquivo local (C:\\...).');
                return false;
            }
            if (!navigator.geolocation) {
                alert('Geolocaliza√ß√£o n√£o √© suportada pelo seu navegador.');
                return false;
            }
            return true;
        }
        function handleGeoError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert('Voc√™ negou o pedido de geolocaliza√ß√£o.');
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert('Informa√ß√£o de localiza√ß√£o indispon√≠vel.');
                    break;
                case error.TIMEOUT:
                    alert('Pedido de localiza√ß√£o expirou.');
                    break;
                default:
                    alert('Um erro desconhecido ocorreu ao buscar localiza√ß√£o.');
                    break;
            }
        }
        function obterGeolocalizacaoLatLng(idLat, idLong) {
            if (!checkSecureContext()) return;
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById(idLat).value = position.coords.latitude.toFixed(6);
                    document.getElementById(idLong).value = position.coords.longitude.toFixed(6);
                },
                handleGeoError
            );
        }
        
        // --- MUDAN√áA AQUI: Link do Google Maps ---
        function obterGeolocalizacaoURL(idInputURL) {
            if (!checkSecureContext()) return;
            const input = document.getElementById(idInputURL);
            input.value = "Obtendo...";
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    // Link padr√£o do Google Maps
                    const mapsLink = `https://www.google.com/maps?q=${lat},${lon}`;
                    input.value = mapsLink;
                },
                (error) => {
                    handleGeoError(error);
                    input.value = "Falha ao obter localiza√ß√£o.";
                }
            );
        }
        // --- FIM DAS FUN√á√ïES GEO ---


        /**
         * Event Listeners dos Geradores
         */

        // URL
        btnUrl.addEventListener('click', (event) => { 
            const url = inputUrl.value;
            if (url) { gerarQRCode(url, event); } else { alert("Por favor, digite uma URL."); }
        });

        // Wi-Fi
        btnWifi.addEventListener('click', (event) => { 
            const ssid = inputWifiSsid.value;
            const pass = inputWifiPass.value;
            if (ssid) {
                const wifiString = `WIFI:T:WPA;S:${ssid};P:${pass};;`;
                gerarQRCode(wifiString, event);
            } else { alert("Por favor, digite pelo menos o nome da rede (SSID)."); }
        });
        
        // vCard (COM MUDAN√áA)
        btnVCard.addEventListener('click', (event) => { 
            const nome = inputVCardNome.value;
            const cargo = inputVCardCargo.value;
            const empresa = inputVCardEmpresa.value;
            const tel = inputVCardTel.value;
            const email = inputVCardEmail.value;
            const site = inputVCardSite.value;
            const lat = inputVCardLat.value.replace(',', '.'); 
            const long = inputVCardLong.value.replace(',', '.'); 

            if (!nome || (!tel && !email)) {
                alert('Nome e pelo menos um Telefone ou E-mail s√£o obrigat√≥rios!');
                return;
            }
            
            let vCardString = [
                'BEGIN:VCARD', 'VERSION:3.0',
                `N:${nome}`, `FN:${nome}`, `ORG:${empresa}`, `TITLE:${cargo}`,
                `TEL;TYPE=WORK,VOICE:${tel}`, `EMAIL:${email}`, `URL:${site}`
            ];
            
            // --- MUDAN√áA AQUI ---
            if (lat && long) {
                // Adiciona o GEO: para apps de contato
                vCardString.push(`GEO:${lat},${long}`);
                // Adiciona o link do Google Maps nas Notas
                const mapsLink = `https://www.google.com/maps?q=${lat},${long}`;
                vCardString.push(`NOTE:Ver no mapa: ${mapsLink}`);
            }
            // --- FIM DA MUDAN√áA ---
            
            vCardString.push('END:VCARD');
            
            gerarQRCode(vCardString.join('\n'), event);
        });

        // WhatsApp
        btnWhatsapp.addEventListener('click', (event) => { 
            let tel = inputWhatsappTel.value;
            let msg = inputWhatsappMsg.value;

            if (!tel) {
                alert('O n√∫mero de telefone √© obrigat√≥rio!');
                return;
            }
            tel = tel.replace(/\D/g, '');
            const encodedMsg = encodeURIComponent(msg);
            
            const whatsappString = `https://wa.me/${tel}?text=${encodedMsg}`;
            gerarQRCode(whatsappString, event);
        });
        
        // Geolocaliza√ß√£o
        btnGeo.addEventListener('click', (event) => { 
            const url = inputGeoUrl.value;
            
            if (!url || url === "Obtendo..." || url === "Falha ao obter localiza√ß√£o.") {
                alert('Por favor, obtenha um link de localiza√ß√£o v√°lido primeiro.');
                return;
            }
            gerarQRCode(url, event);
        });
        
        // Boto√µes GEO
        btnVCardGeoAuto.addEventListener('click', () => {
            obterGeolocalizacaoLatLng('input-vcard-lat', 'input-vcard-long');
        });
        btnMapasGeoAuto.addEventListener('click', () => {
            obterGeolocalizacaoURL('input-geo-url');
        });


        /**
         * Fun√ß√µes do PIX
         */
        function formatarEMV(id, value) {
            const length = ('00' + value.length).slice(-2);
            return `${id}${length}${value}`;
        }
        function simplificarTexto(text) {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/g, '');
        }
        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                crc ^= data.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
            return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4);
        }
        btnPix.addEventListener('click', (event) => { 
            const key = inputPixKey.value;
            let name = inputPixName.value;
            let city = inputPixCity.value;
            let amount = inputPixAmount.value;
            let txid = inputPixTxid.value;

            if (!key || !name || !city) {
                alert("Chave PIX, Nome e Cidade s√£o obrigat√≥rios!");
                return;
            }
            const merchantAccountInfo = [
                formatarEMV('00', 'br.gov.bcb.pix'),
                formatarEMV('01', key)
            ].join('');
            let brCode = [
                formatarEMV('00', '01'),
                formatarEMV('26', merchantAccountInfo),
                formatarEMV('52', '0000'),
                formatarEMV('53', '986')
            ];
            if (amount) {
                const amountComPonto = amount.replace(",", "."); 
                const valorFormatado = parseFloat(amountComPonto).toFixed(2);
                brCode.push(formatarEMV('54', valorFormatado));
            }
            brCode.push(formatarEMV('58', 'BR'));
            name = simplificarTexto(name).substring(0, 25);
            brCode.push(formatarEMV('59', name));
            city = simplificarTexto(city).substring(0, 15);
            brCode.push(formatarEMV('60', city));
            txid = txid ? txid.replace(/\s/g, '') : '***';
            const additionalData = formatarEMV('05', txid);
            brCode.push(formatarEMV('62', additionalData));
            brCode.push('6304');
            let stringPIX = brCode.join('');
            const checksum = crc16(stringPIX);
            const brCodeCompleto = stringPIX + checksum;
            
            gerarQRCode(brCodeCompleto, event);
        });

    </script>
</body>
</html>
