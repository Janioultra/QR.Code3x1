<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de QR Code</title>
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #dcf2e2; 
            color: #333;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 1200px; 
            background-color: transparent; 
            box-shadow: none; 
            border-radius: 8px;
            padding: 24px;
        }

        h1 {
            text-align: center;
            color: #111;
            margin-bottom: 24px;
        }

        h2 {
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
            margin-top: 0;
        }

        .geradores {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 20px;
        }

        @media (min-width: 768px) {
            .geradores {
                grid-template-columns: 1fr 1fr; 
            }
        }
        @media (min-width: 1024px) {
            .geradores {
                grid-template-columns: 1fr 1fr 1fr; 
            }
        }

        .box {
            background-color: rgba(255, 255, 255, 0.5); 
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="tel"], 
        input[type="email"], 
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fff;
            color: #333;
        }
        
        input#input-geo-url {
            background-color: #f1f5f9; 
            color: #64748b; 
            font-size: 0.9em;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #34c759; 
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .box > button:last-of-type {
            margin-top: auto;
        }

        button:hover {
            background-color: #28a745; 
        }

        .btn-geo-auto {
            background-color: #6c757d;
            font-size: 14px;
            padding: 8px;
            margin-top: -5px; 
            margin-bottom: 12px;
        }
        .btn-geo-auto:hover {
            background-color: #5a6268;
        }

        .color-inputs {
            display: flex;
            justify-content: space-around;
            gap: 15px;
            padding: 10px 0;
            margin-top: auto; 
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .color-inputs > div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-inputs label {
            font-size: 14px;
            font-weight: 500;
        }
        .color-inputs input[type="color"] {
            width: 40px;
            height: 40px;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 6px; }
        input[type="color"]::-moz-color-swatch { border: none; border-radius: 6px; }

        .resultado {
            margin-top: 24px;
            text-align: center;
        }

        #qrcode {
            width: 256px;
            height: 256px;
            margin: 16px auto;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background-color: #fafafa;
            color: transparent; 
        }

        #qrcode img,
        #qrcode canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .botoes-resultado {
            display: flex;
            gap: 10px;
            justify-content: center;
            max-width: 278px;
            margin: 0 auto;
            margin-top: 16px;
        }
        .botoes-resultado button { width: auto; flex-grow: 1; }
        #btn-download { background-color: #28a745; }
        #btn-download:hover { background-color: #218838; }
        #btn-print { background-color: #6c757d; }
        #btn-print:hover { background-color: #5a6268; }
        #btn-limpar { background-color: #dc3545; }
        #btn-limpar:hover { background-color: #c82333; }

        .hidden {
            display: none;
        }
        
        .box p.info {
            font-size: 0.9em;
            color: #555;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        /* --- ESTILOS DO MODAL DE AVISO --- */
        #modal-aviso {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Come√ßa escondido */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #modal-aviso.show {
            display: flex; /* Mostra o modal */
        }
        #modal-aviso-content {
            background-color: #fff;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        #modal-aviso-content h3 {
            margin-top: 0;
            color: #dc3545;
        }
        #modal-aviso-content p {
            margin-bottom: 20px;
            font-size: 16px;
        }
        #btn-modal-fechar {
            background-color: #007aff;
            width: auto;
            padding: 10px 20px;
        }
        #btn-modal-fechar:hover {
            background-color: #0056b3;
        }
        /* --- FIM DOS ESTILOS DO MODAL --- */


        /* * ==============================================================
         * AQUI EST√Å A CORRE√á√ÉO PARA IMPRESS√ÉO (VERS√ÉO FINAL)
         * ==============================================================
         */
        @media print {
            /* 1. Esconde TUDO da p√°gina por padr√£o */
            body * {
                visibility: hidden;
            }

            /* 2. Torna vis√≠vel APENAS o container do QR code e o que est√° dentro dele */
            #qrcode, #qrcode * {
                visibility: visible;
            }

            /* 3. Posiciona o container do QR code no centro da p√°gina de impress√£o */
            #qrcode {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                border: none;
                box-shadow: none;
                padding: 0;
                margin: 0; 
            }

            /* 4. CORRE√á√ÉO IMPORTANTE: Mostra APENAS o <canvas> */
            #qrcode canvas {
                display: block !important;
                visibility: visible !important;
                max-width: 90vmin; 
                max-height: 90vmin;
                width: auto;
                height: auto;
            }
            
            /* 5. CORRE√á√ÉO IMPORTANTE: Esconde qualquer <img> fallback */
            #qrcode img {
                display: none !important; 
                visibility: hidden !important;
            }
        }
        /* --- FIM DA CORRE√á√ÉO DE IMPRESS√ÉO --- */


        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #333; 
        }
        footer p { margin: 5px 0; }

    </style>
</head>
<body>

    <div class="container">
        <h1>Gerador de QR Code</h1>

        <div class="geradores">
            <!-- 1. URL -->
            <div class="box">
                <h2>Site / URL</h2>
                <input type="text" id="input-url" placeholder="https://seusite.com.br">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-url">Gerar QR Code</button>
            </div>
            
            <!-- 2. Wi-Fi -->
            <div class="box">
                <h2>Conex√£o Wi-Fi</h2>
                <input type="text" id="input-wifi-ssid" placeholder="Nome da rede (SSID)">
                <input type="password" id="input-wifi-pass" placeholder="Senha da rede">
                <!-- CAMPO DE MAPS ADICIONADO -->
                <input type="text" class="input-location-link" placeholder="Link do Google Maps (opcional)">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-wifi">Gerar QR Code</button>
            </div>
            
            <!-- 3. PIX (Sem campo de mapa, pois quebraria o BRCode) -->
            <div class="box">
                <h2>PIX (Gerador BR Code)</h2>
                <input type="text" id="input-pix-key" placeholder="Sua Chave PIX (CPF, e-mail, etc)">
                <input type="text" id="input-pix-name" placeholder="Seu Nome (at√© 25 chars)">
                <input type="text" id="input-pix-city" placeholder="Sua Cidade (at√© 15 chars)">
                <input type="text" id="input-pix-amount" placeholder="Valor (Ex: 10,50) (opcional)">
                <input type="text" id="input-pix-txid" placeholder="ID da Transa√ß√£o (opcional)">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-pix">Gerar QR Code PIX</button>
            </div>

            <!-- 4. vCard -->
            <div class="box">
                <h2>Cart√£o de Visita (vCard)</h2>
                <input type="text" id="input-vcard-nome" placeholder="Nome Completo">
                <input type="text" id="input-vcard-cargo" placeholder="Cargo (Ex: Desenvolvedor)">
                <input type="text" id="input-vcard-empresa" placeholder="Empresa">
                <input type="tel" id="input-vcard-tel" placeholder="Telefone (ex: +55 75 9...)">
                <input type="email" id="input-vcard-email" placeholder="E-mail">
                <input type="text" id="input-vcard-site" placeholder="Site (ex: https://...)">
                <!-- CAMPO DE MAPS ADICIONADO -->
                <input type="text" class="input-location-link" placeholder="Link do Google Maps (opcional)">
                <input type="text" id="input-vcard-lat" placeholder="Latitude (opcional)">
                <input type="text" id="input-vcard-long" placeholder="Longitude (opcional)">
                <button type="button" id="btn-vcard-geo-auto" class="btn-geo-auto">üìç Usar minha localiza√ß√£o (Lat/Long)</button>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-vcard">Gerar vCard</button>
            </div>
            
            <!-- 5. WhatsApp -->
            <div class="box">
                <h2>WhatsApp</h2>
                <input type="tel" id="input-whatsapp-tel" placeholder="N¬∫ (ex: 5575998312170)">
                <textarea id="input-whatsapp-msg" placeholder="Mensagem padr√£o (opcional)"></textarea>
                <!-- CAMPO DE MAPS ADICIONADO -->
                <input type="text" class="input-location-link" placeholder="Link do Google Maps (opcional)">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-whatsapp">Gerar Link Zap</button>
            </div>
            
            <!-- 6. Localiza√ß√£o (Mapas) -->
            <div class="box">
                <h2>Localiza√ß√£o (Google Maps)</h2>
                <p class="info">Clique no bot√£o para pegar sua localiza√ß√£o atual e gerar um link do Google Maps.</p>
                <input type="text" id="input-geo-url" placeholder="Link do Google Maps aparecer√° aqui..." readonly>
                <button type="button" id="btn-mapas-geo-auto" class="btn-geo-auto">üìç Obter Localiza√ß√£o (Google Maps)</button>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-geo">Gerar Mapa</button>
            </div>
            
            <!-- 7. Meu Neg√≥cio -->
            <div class="box">
                <h2>Meu Neg√≥cio (Texto PRO)</h2>
                <input type="text" id="input-negocio-titulo" placeholder="Empresa (Ex: INTERNET ULTRA FIBRA)">
                <input type="text" id="input-negocio-slogan" placeholder="Slogan (Ex: OTIMO PLANOS...)">
                <input type="tel" id="input-negocio-zap" placeholder="WhatsApp (Ex: 75998312170)">
                <input type="text" id="input-negocio-site" placeholder="Site (https://...)">
                <input type="text" id="input-negocio-insta" placeholder="Instagram (https://...)">
                <!-- CAMPO DE MAPS ADICIONADO -->
                <input type="text" class="input-location-link" placeholder="Link do Google Maps (opcional)">
                <textarea id="input-negocio-cta" placeholder="Chamada (Ex: CLICK NO SITE...)"></textarea>
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-negocio">Gerar An√∫ncio</button>
            </div>

            <!-- 8. Imagem (URL) -->
            <div class="box">
                <h2>QR Code de Imagem (Link)</h2>
                <p class="info">Cole o link (URL) de uma imagem que j√° esteja na internet.</p>
                <input type="text" id="input-image-url" placeholder="https://.../imagem.png">
                <div class="color-inputs">
                    <div>
                        <label>Cor:</label>
                        <input type="color" class="color-dark-input" value="#000000">
                    </div>
                    <div>
                        <label>Fundo:</label>
                        <input type="color" class="color-light-input" value="#ffffff">
                    </div>
                </div>
                <button id="btn-image-url">Gerar Link de Imagem</button>
            </div>

        </div> 
        
        <div class="resultado">
            <h2>Seu QR Code:</h2>
            <div id="qrcode"></div>
            
            <div class="botoes-resultado">
                <button id="btn-download" class="hidden">Download (PNG)</button>
                <button id="btn-print" class="hidden">Imprimir</button>
                <button id="btn-limpar" class="hidden">Limpar</button>
            </div>
        </div>
    </div> 
    
    <footer>
        <p>Todos os direitos reservados ¬© 2025 J√¢nio Carlos P</p>
        <p>WhatsApp: 55 75 99831-2170</p>
    </footer>

    <!-- MODAL DE AVISO (HTML) -->
    <div id="modal-aviso">
        <div id="modal-aviso-content">
            <h3>Aten√ß√£o!</h3>
            <p id="modal-aviso-texto"></p>
            <button id="btn-modal-fechar">Entendi</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        // --- Seletores B√°sicos ---
        const qrContainer = document.getElementById('qrcode');
        const resultadoSection = document.querySelector('.resultado'); 
        let qrcode = null;

        // --- Seletores do Modal de Aviso ---
        const modalAviso = document.getElementById('modal-aviso');
        const modalAvisoTexto = document.getElementById('modal-aviso-texto');
        const btnModalFechar = document.getElementById('btn-modal-fechar');

        // --- Seletores dos Geradores (Bloco 1) ---
        const btnUrl = document.getElementById('btn-url');
        const inputUrl = document.getElementById('input-url');
        const btnWifi = document.getElementById('btn-wifi');
        const inputWifiSsid = document.getElementById('input-wifi-ssid');
        const inputWifiPass = document.getElementById('input-wifi-pass');
        
        // --- Seletores dos Geradores (Bloco 2) ---
        const btnPix = document.getElementById('btn-pix');
        const inputPixKey = document.getElementById('input-pix-key');
        const inputPixName = document.getElementById('input-pix-name');
        const inputPixCity = document.getElementById('input-pix-city');
        const inputPixAmount = document.getElementById('input-pix-amount');
        const inputPixTxid = document.getElementById('input-pix-txid');
        
        // --- Seletores do vCard ---
        const btnVCard = document.getElementById('btn-vcard');
        const inputVCardNome = document.getElementById('input-vcard-nome');
        const inputVCardCargo = document.getElementById('input-vcard-cargo');
        const inputVCardEmpresa = document.getElementById('input-vcard-empresa');
        const inputVCardTel = document.getElementById('input-vcard-tel');
        const inputVCardEmail = document.getElementById('input-vcard-email');
        const inputVCardSite = document.getElementById('input-vcard-site');
        const inputVCardLat = document.getElementById('input-vcard-lat');
        const inputVCardLong = document.getElementById('input-vcard-long');
        const btnVCardGeoAuto = document.getElementById('btn-vcard-geo-auto'); 
        
        // --- Seletores (WhatsApp) ---
        const btnWhatsapp = document.getElementById('btn-whatsapp');
        const inputWhatsappTel = document.getElementById('input-whatsapp-tel');
        const inputWhatsappMsg = document.getElementById('input-whatsapp-msg');

        // --- Seletores (Geo Mapas) ---
        const btnGeo = document.getElementById('btn-geo');
        const inputGeoUrl = document.getElementById('input-geo-url'); 
        const btnMapasGeoAuto = document.getElementById('btn-mapas-geo-auto'); 

        // --- Seletores (Neg√≥cio) ---
        const btnNegocio = document.getElementById('btn-negocio');
        const inputNegocioTitulo = document.getElementById('input-negocio-titulo');
        const inputNegocioSlogan = document.getElementById('input-negocio-slogan');
        const inputNegocioZap = document.getElementById('input-negocio-zap');
        const inputNegocioSite = document.getElementById('input-negocio-site');
        const inputNegocioInsta = document.getElementById('input-negocio-insta');
        const inputNegocioCta = document.getElementById('input-negocio-cta');

        // --- Seletores (Imagem URL) ---
        const btnImageUrl = document.getElementById('btn-image-url');
        const inputImageUrl = document.getElementById('input-image-url');

        // --- Seletores (Resultado) ---
        const btnLimpar = document.getElementById('btn-limpar');
        const btnDownload = document.getElementById('btn-download');
        const btnPrint = document.getElementById('btn-print');

        // --- FUN√á√ïES DO MODAL DE AVISO ---
        function showModal(message) {
            modalAvisoTexto.textContent = message;
            modalAviso.classList.add('show');
        }

        function closeModal() {
            modalAviso.classList.remove('show');
        }

        btnModalFechar.addEventListener('click', closeModal);
        modalAviso.addEventListener('click', (event) => {
            if (event.target === modalAviso) {
                closeModal();
            }
        });
        // --- FIM DAS FUN√á√ïES DO MODAL ---


        /**
         * Fun√ß√£o principal de Gera√ß√£o (com Scroll)
         */
        function gerarQRCode(texto, event) {
            limparQRCode(false); 
            
            if (!event || !event.target) {
                console.error("O evento de clique n√£o foi passado corretamente para gerarQRCode.");
                showModal("Ocorreu um erro inesperado. Tente novamente.");
                return;
            }
            
            const box = event.target.closest('.box');
            if (!box) {
                 console.error("N√£o foi poss√≠vel encontrar o '.box' pai do bot√£o.");
                 showModal("Ocorreu um erro inesperado (DOM). Tente novamente.");
                 return;
            }

            const corPrincipal = box.querySelector('.color-dark-input').value;
            const corFundo = box.querySelector('.color-light-input').value;

            try {
                qrcode = new QRCode(qrContainer, {
                    text: texto,
                    width: 256,
                    height: 256,
                    colorDark: corPrincipal, 
                    colorLight: corFundo,  
                    correctLevel: QRCode.CorrectLevel.M // N√≠vel M√©dio
                });
                
                btnLimpar.classList.remove('hidden');
                btnDownload.classList.remove('hidden');
                btnPrint.classList.remove('hidden');

                resultadoSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                console.error("Erro ao gerar QR Code:", error);
                let userMessage = "Ocorreu um erro ao gerar o QR Code. ";
                if (error.message.includes("code length overflow")) {
                    userMessage += "Os dados inseridos s√£o muito longos para este tipo de QR Code.";
                } else {
                    userMessage += `Detalhe: ${error.message}`;
                }
                showModal(userMessage);
            }
        }

        /**
         * Fun√ß√£o de Limpeza (COM CORRE√á√ÉO)
         */
        function limparQRCode(resetColors = true) {
            if (qrcode) {
                qrcode.clear();
                qrcode = null; 
            }
            qrContainer.innerHTML = ''; 
            
            btnLimpar.classList.add('hidden');
            btnDownload.classList.add('hidden');
            btnPrint.classList.add('hidden');

            if (resetColors) {
                const allDark = document.querySelectorAll('.color-dark-input');
                const allLight = document.querySelectorAll('.color-light-input');
                allDark.forEach(input => input.value = "#000000");
                allLight.forEach(input => input.value = "#ffffff");
            }
        }
        
        btnLimpar.addEventListener('click', () => limparQRCode(true)); 

        /**
         * Bot√µes de A√ß√£o (Download/Print)
         */
        btnPrint.addEventListener('click', () => {
            window.print();
        });

        btnDownload.addEventListener('click', () => {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                showModal('Erro: Canvas do QR Code n√£o encontrado.'); 
                return;
            }
            const imgURL = canvas.toDataURL('image/png');

            if (isIOS) {
                const newTab = window.open();
                newTab.document.write(`<img src="${imgURL}" alt="QR Code" style="width:100%;">`);
            } else {
                const link = document.createElement('a');
                link.href = imgURL;
                link.download = 'qrcode.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });
        
        // --- FUN√á√ïES DE GEOLOCALIZA√á√ÉO ---
        function checkSecureContext() {
            if (window.location.protocol !== 'https:') {
                showModal('Este recurso s√≥ funciona em sites seguros (https).\n\nFunciona no link do GitHub Pages, mas n√£o no arquivo local (C:\\...).'); 
                return false;
            }
            if (!navigator.geolocation) {
                showModal('Geolocaliza√ß√£o n√£o √© suportada pelo seu navegador.'); 
                return false;
            }
            return true;
        }
        function handleGeoError(error) {
            let message = 'Um erro desconhecido ocorreu ao buscar localiza√ß√£o.';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Voc√™ negou o pedido de geolocaliza√ß√£o.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Informa√ß√£o de localiza√ß√£o indispon√≠vel.';
                    break;
                case error.TIMEOUT:
                    message = 'Pedido de localiza√ß√£o expirou.';
                    break;
            }
            showModal(message); 
        }
        function obterGeolocalizacaoLatLng(idLat, idLong) {
            if (!checkSecureContext()) return;
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById(idLat).value = position.coords.latitude.toFixed(6);
                    document.getElementById(idLong).value = position.coords.longitude.toFixed(6);
                },
                handleGeoError
            );
        }
        
        function obterGeolocalizacaoURL(idInputURL) {
            if (!checkSecureContext()) return;
            const input = document.getElementById(idInputURL);
            input.value = "Obtendo...";
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const mapsLink = `https://www.google.com/maps?q=${lat},${lon}`;
                    input.value = mapsLink;
                },
                (error) => {
                    handleGeoError(error);
                    input.value = "Falha ao obter localiza√ß√£o.";
                }
            );
        }
        // --- FIM DAS FUN√á√ïES GEO ---


        /**
         * Event Listeners dos Geradores
         */

        // URL
        btnUrl.addEventListener('click', (event) => { 
            const url = inputUrl.value;
            if (url) { gerarQRCode(url, event); } else { showModal("Por favor, digite uma URL."); } 
        });

        // Wi-Fi (ATUALIZADO)
        btnWifi.addEventListener('click', (event) => { 
            const ssid = inputWifiSsid.value;
            const pass = inputWifiPass.value;
            const mapLink = event.target.closest('.box').querySelector('.input-location-link').value; // Pega o link

            if (ssid) {
                let wifiString = `WIFI:T:WPA;S:${ssid};P:${pass};;`;
                if (mapLink) {
                    wifiString += `\n\nLocaliza√ß√£o: ${mapLink}`; // Adiciona o link ao texto
                }
                gerarQRCode(wifiString, event);
            } else { 
                showModal("Por favor, digite pelo menos o nome da rede (SSID)."); 
            }
        });
        
        // vCard (ATUALIZADO)
        btnVCard.addEventListener('click', (event) => { 
            const box = event.target.closest('.box');
            const nome = inputVCardNome.value;
            const cargo = inputVCardCargo.value;
            const empresa = inputVCardEmpresa.value;
            const tel = inputVCardTel.value;
            const email = inputVCardEmail.value;
            const site = inputVCardSite.value;
            const lat = inputVCardLat.value.replace(',', '.'); 
            const long = inputVCardLong.value.replace(',', '.'); 
            const mapLink = box.querySelector('.input-location-link').value; // Pega o link

            if (!nome || (!tel && !email)) {
                showModal('Nome e pelo menos um Telefone ou E-mail s√£o obrigat√≥rios!'); 
                return;
            }
            
            let vCardString = [
                'BEGIN:VCARD', 'VERSION:3.0',
                `N:${nome}`, `FN:${nome}`, `ORG:${empresa}`, `TITLE:${cargo}`,
                `TEL;TYPE=WORK,VOICE:${tel}`, `EMAIL:${email}`, `URL:${site}`
            ];
            
            // Adiciona GEO (para apps de contacto)
            if (lat && long) {
                vCardString.push(`GEO:${lat},${long}`);
            }
            
            // Adiciona o link do Google Maps na NOTA (para humanos)
            if (mapLink) {
                vCardString.push(`NOTE:Localiza√ß√£o: ${mapLink}`);
            }
            
            vCardString.push('END:VCARD');
            
            gerarQRCode(vCardString.join('\n'), event);
        });

        // WhatsApp (ATUALIZADO)
        btnWhatsapp.addEventListener('click', (event) => { 
            let tel = inputWhatsappTel.value;
            let msg = inputWhatsappMsg.value;
            const mapLink = event.target.closest('.box').querySelector('.input-location-link').value; // Pega o link

            if (!tel) {
                showModal('O n√∫mero de telefone √© obrigat√≥rio!'); 
                return;
            }
            tel = tel.replace(/\D/g, '');
            const encodedMsg = encodeURIComponent(msg);
            
            const whatsappString = `https://wa.me/${tel}?text=${encodedMsg}`;
            
            // Adiciona o link do mapa ao texto do QR (n√£o √† mensagem do WhatsApp, mas ao QR)
            let qrText = whatsappString;
            if (mapLink) {
                qrText += `\n\nLocaliza√ß√£o: ${mapLink}`;
            }
            
            gerarQRCode(qrText, event);
        });
        
        // Geolocaliza√ß√£o
        btnGeo.addEventListener('click', (event) => { 
            const url = inputGeoUrl.value;
            
            if (!url || url === "Obtendo..." || url === "Falha ao obter localiza√ß√£o.") {
                showModal('Por favor, obtenha um link de localiza√ß√£o v√°lido primeiro.'); 
                return;
            }
            gerarQRCode(url, event);
        });
        
        // --- Event Listener (Meu Neg√≥cio) (ATUALIZADO) ---
        btnNegocio.addEventListener('click', (event) => {
            const box = event.target.closest('.box');
            const titulo = inputNegocioTitulo.value;
            const slogan = inputNegocioSlogan.value;
            const zap = inputNegocioZap.value;
            const site = inputNegocioSite.value;
            const insta = inputNegocioInsta.value;
            const mapLink = box.querySelector('.input-location-link').value; // Pega o link
            const cta = inputNegocioCta.value;
            
            if (!titulo) {
                showModal('O T√≠tulo da Empresa √© obrigat√≥rio!'); 
                return;
            }
            
            let textoFormatado = `=== ${titulo.toUpperCase()} ===\n`;
            if (slogan) textoFormatado += `_ ${slogan} _\n\n`;
            
            if (zap) textoFormatado += `WhatsApp: ${zap}\n`;
            if (site) textoFormatado += `Site: ${site}\n`;
            if (insta) textoFormatado += `Instagram: ${insta}\n`;
            if (mapLink) {
                textoFormatado += `Local: ${mapLink}\n`; // Adiciona o link
            }
            
            if (cta) textoFormatado += `\n${cta}`;
            
            gerarQRCode(textoFormatado, event); 
        });

        // --- Event Listener (Imagem URL) ---
        btnImageUrl.addEventListener('click', (event) => {
            const url = inputImageUrl.value;
            if (url) {
                gerarQRCode(url, event);
            } else {
                showModal("Por favor, cole o link (URL) da imagem.");
            }
        });

        // Boto√µes GEO
        btnVCardGeoAuto.addEventListener('click', () => {
            obterGeolocalizacaoLatLng('input-vcard-lat', 'input-vcard-long');
        });
        btnMapasGeoAuto.addEventListener('click', () => {
            obterGeolocalizacaoURL('input-geo-url');
        });


        /**
         * Fun√ß√µes do PIX
         */
        function formatarEMV(id, value) {
            const length = ('00' + value.length).slice(-2);
            return `${id}${length}${value}`;
        }
        function simplificarTexto(text) {
            if (!text) return '';
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s.-]/g, ''); 
        }
        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                crc ^= data.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
            return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4);
        }
        
        btnPix.addEventListener('click', (event) => { 
            const key = inputPixKey.value;
            let name = inputPixName.value;
            let city = inputPixCity.value;
            let amount = inputPixAmount.value;
            let txid = inputPixTxid.value;

            if (!key || !name || !city) {
                showModal("Chave PIX, Nome e Cidade s√£o obrigat√≥rios!"); 
                return;
            }
            
            name = simplificarTexto(name).substring(0, 25);
            city = simplificarTexto(city).substring(0, 15);
            txid = txid ? simplificarTexto(txid).replace(/\s/g, '').substring(0, 25) : '***';
             if (txid.length === 0) txid = '***';

            const merchantAccountInfo = [
                formatarEMV('00', 'br.gov.bcb.pix'),
                formatarEMV('01', key)
            ].join('');

            let brCode = [
                formatarEMV('00', '01'),
                formatarEMV('26', merchantAccountInfo),
                formatarEMV('52', '0000'), 
                formatarEMV('53', '986') 
            ];

            if (amount) {
                const amountComPonto = amount.replace(",", "."); 
                const valorNumerico = parseFloat(amountComPonto);
                
                if (isNaN(valorNumerico) || valorNumerico <= 0) {
                     showModal("O valor do PIX parece inv√°lido. Use n√∫meros como 10,50.");
                     return;
                }
                const valorFormatado = valorNumerico.toFixed(2);
                brCode.push(formatarEMV('54', valorFormatado));
            }

            brCode.push(formatarEMV('58', 'BR')); 
            brCode.push(formatarEMV('59', name)); 
            brCode.push(formatarEMV('60', city)); 

            const additionalData = formatarEMV('05', txid);
            brCode.push(formatarEMV('62', additionalData));
            
            brCode.push('6304'); 
            
            let stringPIX = brCode.join('');
            const checksum = crc16(stringPIX);
            const brCodeCompleto = stringPIX + checksum;
            
            gerarQRCode(brCodeCompleto, event);
        });

    </script>
</body>
</html>
